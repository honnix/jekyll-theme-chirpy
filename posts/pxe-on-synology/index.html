<!DOCTYPE html><html lang="en-US" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="PXE on Synology" /><meta property="og:locale" content="en_US" /><meta name="description" content="How to set up PXE on Synology NAS working together with pfSense" /><meta property="og:description" content="How to set up PXE on Synology NAS working together with pfSense" /><link rel="canonical" href="https://honnix.com/posts/pxe-on-synology/" /><meta property="og:url" content="https://honnix.com/posts/pxe-on-synology/" /><meta property="og:site_name" content="Honnix@tech" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2016-09-14T00:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="PXE on Synology" /><meta name="twitter:site" content="@honnix" /><meta name="google-site-verification" content="UdzD48neNig8HtUu7tW1_1rL2tseB14AE_utbxuEhow" /> <script type="application/ld+json"> {"mainEntityOfPage":{"@type":"WebPage","@id":"https://honnix.com/posts/pxe-on-synology/"},"description":"How to set up PXE on Synology NAS working together with pfSense","url":"https://honnix.com/posts/pxe-on-synology/","@type":"BlogPosting","headline":"PXE on Synology","dateModified":"2016-09-14T00:00:00+02:00","datePublished":"2016-09-14T00:00:00+02:00","@context":"https://schema.org"}</script><title>PXE on Synology | Honnix@tech</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Honnix@tech"><meta name="application-name" content="Honnix@tech"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-4908407-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-4908407-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Honnix@tech</a></div><div class="site-subtitle font-italic">Very occasionally I write blog.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/honnix" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/honnix" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['hxliang1982','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>PXE on Synology</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>PXE on Synology</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Hongxin Liang </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Sep 14, 2016, 12:00 AM +0200" prep="on" > Sep 14, 2016 <i class="unloaded">2016-09-14T00:00:00+02:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="524 words">2 min</span></div></div><div class="post-content"><p>As my home network grows more and more complex, I need to find something to make it even more complex. Yes, why not setting up a PXE server? I actually have and may have more Linux boxes to install.</p><p>While there are many articles talking about setting up PXE on Synolgoy NAS, none of them can fit my requirement, that is using the most complicated way.</p><p>Well I’m lying. I actually want the most simple and flexible approach, which is using <a href="http://cobbler.github.io">Cobbler</a>.</p><p>The Synolgoy NAS I have runs on x86, which means it has the capability to run Docker properly, and the good news is there are a few existing Cobbler Docker images on <a href="https://hub.docker.com">Docker hub</a>. But unfortunatley none of them is properly made.</p><p>Then this <a href="http://container-solutions.com/cobbler-in-a-docker-container/">article</a> is quite helpful except that it doesn’t work, at least not very much. The problem is tftp server simply cannot work without specifying <code class="language-plaintext highlighter-rouge">--net host</code> when creating the container.</p><p>Without <code class="language-plaintext highlighter-rouge">--net host</code>, Docker will use <code class="language-plaintext highlighter-rouge">iptables</code> and <code class="language-plaintext highlighter-rouge">docker-proxy</code> to do NAT to containers, and the way tftp server works is similar to the active mode ftp server, which means it initiates connection from an ephemeral port toward the client and of course this won’t work under NAT.</p><p>OK. I start from that article to make my own customization, so here it is: <a href="https://github.com/honnix/docker-cobbler">docker-cobbler</a>.</p><p>The <code class="language-plaintext highlighter-rouge">Dockerfile</code> is pretty straight forward, installing <code class="language-plaintext highlighter-rouge">cobbler</code>, <code class="language-plaintext highlighter-rouge">cobbler-web</code>, <code class="language-plaintext highlighter-rouge">pykickstart</code> (for <code class="language-plaintext highlighter-rouge">cobbler validateks</code>), exposing related port. Since systemd refuses to work on my NAS (lower version of Docker, maybe?), I need to start <code class="language-plaintext highlighter-rouge">httpd</code> and <code class="language-plaintext highlighter-rouge">cobbler</code> manually.</p><p>So, now the problem is how about tftp server. Fortunately I can run it on my NAS directly by following the <a href="https://www.synology.com/en-us/knowledgebase/DSM/tutorial/General/How_to_implement_PXE_with_Synology_NAS">official document</a>.</p><p>I create a shared folder as <code class="language-plaintext highlighter-rouge">TFTP root folder</code>, but it’s not necessary and it’s up to you. But that folder should be mapped to a cobbler container volume in order for cobbler to access, for example <code class="language-plaintext highlighter-rouge">-v /volume1/tftpboot:/var/lib/tftpboot</code>.</p><p><code class="language-plaintext highlighter-rouge">./build.sh</code> will create the image, and <code class="language-plaintext highlighter-rouge">./start.sh</code> will start a container using the image.</p><p>But before that, let’s talk about networking. Did I mention I have a pfSense firewall at home?</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img//2016-09-14-pxe-on-synology/home_network.png" alt="" title="Home Network" /></p><p>pfSense manages DHCP for my home network, so first all I need to configure <code class="language-plaintext highlighter-rouge">next server</code> and <code class="language-plaintext highlighter-rouge">Default BIOS file name</code>. <code class="language-plaintext highlighter-rouge">next server</code> points to my NAS where tftp is running.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img//2016-09-14-pxe-on-synology/network_booting.png" alt="" title="Network Booting" width="400px" /></p><p>I assign a virtual IP address to pfSense and port forward that to my NAS, so that I can use that IP address to access exported ports from the container.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img//2016-09-14-pxe-on-synology/virtual_ip.png" alt="" title="Virtual IP" width="400px" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img//2016-09-14-pxe-on-synology/port_forward.png" alt="" title="Port forward" width="600px" /></p><p>Note that there is a “black hole” that doesn’t exist in my home network to handle all the other ports, otherwise accessing the virutal IP will bring you to pfSense. You can of course create firewall rules to further block everything else. As a side note, pfSense does NAT first and then firewall. In the above screenshots, <code class="language-plaintext highlighter-rouge">192.168.17.4</code> leads us to cobbler.</p><p>Since I don’t use cobbler to manage anything, in <code class="language-plaintext highlighter-rouge">settings</code> file I disable everything. It is very important to set <code class="language-plaintext highlighter-rouge">server: 192.168.17.4</code> because this is how cobbler can be accessed by client, and this IP is used to generate files under <code class="language-plaintext highlighter-rouge">pxelinux.cfg</code>. Super super important!</p><p>That is pretty much everything, hopefully.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/technology/'>Technology</a>, <a href='/categories/linux/'>Linux</a>, <a href='/categories/docker/'>Docker</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/docker/" class="post-tag no-text-decoration" >Docker</a> <a href="/tags/synology/" class="post-tag no-text-decoration" >Synology</a> <a href="/tags/pxe/" class="post-tag no-text-decoration" >PXE</a> <a href="/tags/pfsense/" class="post-tag no-text-decoration" >pfSense</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=PXE on Synology - Honnix@tech&url=https://honnix.com/posts/pxe-on-synology/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=PXE on Synology - Honnix@tech&u=https://honnix.com/posts/pxe-on-synology/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=PXE on Synology - Honnix@tech&url=https://honnix.com/posts/pxe-on-synology/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/archives/566">如何在Lift里用javascript的confirm</a><li><a href="/posts/bluetooth-keyboard-trouble-20/">Bluetooth keyboard trouble 2.0</a><li><a href="/archives/762">在虚拟机里安装openstack</a><li><a href="/posts/sonatype-nexus-on-raspberry-pi/">Sonatype Nexus on Raspberry Pi</a><li><a href="/posts/homebrew-and-git-svn/">Homebrew and git svn</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/scala/">Scala</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/mac/">Mac</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/lift/">Lift</a> <a class="post-tag" href="/tags/shit/">Shit</a> <a class="post-tag" href="/tags/javascript/">Javascript</a> <a class="post-tag" href="/tags/virtualbox/">VirtualBox</a> <a class="post-tag" href="/tags/libfetion/">libfetion</a> <a class="post-tag" href="/tags/gentoo/">Gentoo</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/cobbler-in-virtualbox/"><div class="card-body"> <span class="timeago small" > Feb 15, 2014 <i class="unloaded">2014-02-15T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cobbler in VirtualBox</h3><div class="text-muted small"><p> Cobbler can help you with all those complicated things for network installation, i.e. PXE, DHCP, etc. Here is a brief instruction for trying it out in VirtualBox with Ubuntu as guest OS. To set u...</p></div></div></a></div><div class="card"> <a href="/posts/pfsense-as-router-in-openstack/"><div class="card-body"> <span class="timeago small" > Nov 24, 2015 <i class="unloaded">2015-11-24T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>pfSense as a proper router in OpenStack</h3><div class="text-muted small"><p> Well, this is a little bit cheating because I started with an already made pfSense image by my colleague. Nevertheless, it’s still a long story. Fix Disk Error When making the image, UUID wasn’t ...</p></div></div></a></div><div class="card"> <a href="/archives/494"><div class="card-body"> <span class="timeago small" > Nov 22, 2009 <i class="unloaded">2009-11-22T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>ChromeOS印象</h3><div class="text-muted small"><p> 启动快，的确是快，虚拟机里面也就是4、5秒的样子。 很多地方可以下到，我就不多说了。VirtualBox里面配的时候要选择这个网卡：Intel Pro/1000 MT Desktop (82540EM)。如果还是登不上去，就用这个用户和密码：chronos/password。具体看这里。 基本上就是一个浏览器，跟Google说的一样，所有的东西都在网上，当然，也可以看到硬盘上安装的东西：...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/pfsense-as-router-in-openstack/" class="btn btn-outline-primary" prompt="Older"><p>pfSense as a proper router in OpenStack</p></a> <a href="/posts/simulate-prolog-backtracking-using-scala-stream/" class="btn btn-outline-primary" prompt="Newer"><p>Simulate Prolog backtracking using Scala Stream</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//honnix.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'PXE on Synology'; this.page.url = 'https://honnix.com/posts/pxe-on-synology/'; this.page.identifier = '/posts/pxe-on-synology/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://github.com/honnix">Hongxin Liang</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/scala/">Scala</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/mac/">Mac</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/lift/">Lift</a> <a class="post-tag" href="/tags/shit/">Shit</a> <a class="post-tag" href="/tags/javascript/">Javascript</a> <a class="post-tag" href="/tags/virtualbox/">VirtualBox</a> <a class="post-tag" href="/tags/libfetion/">libfetion</a> <a class="post-tag" href="/tags/gentoo/">Gentoo</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://honnix.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
